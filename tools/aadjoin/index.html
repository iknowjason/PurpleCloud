
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.3.1, mkdocs-material-8.4.3">
    
    
      
        <title>AAD Join - Hybrid + Identity Cyber Range</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.6b80c2a2.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.cbb835fc.min.css">
        
      
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="deep-purple" data-md-color-accent="indigo">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#azure-ad-join-lab" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Hybrid + Identity Cyber Range" class="md-header__button md-logo" aria-label="Hybrid + Identity Cyber Range" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Hybrid + Identity Cyber Range
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              AAD Join
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="deep-purple" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
            </label>
          
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/iknowjason/PurpleCloud" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    iknowjason/PurpleCloud
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href="../.." class="md-tabs__link">
      Home
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../../overview/" class="md-tabs__link">
      Overview
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../../install/" class="md-tabs__link">
      Installation
    </a>
  </li>

      
        
  
  
    
  


  
  
  
    <li class="md-tabs__item">
      <a href="../aad/" class="md-tabs__link md-tabs__link--active">
        Tool Usage
      </a>
    </li>
  

      
        
  
  


  <li class="md-tabs__item">
    <a href="../../cost/" class="md-tabs__link">
      Cost
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../../references/" class="md-tabs__link">
      References
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../../future/" class="md-tabs__link">
      Roadmap Ideas
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../../credits/" class="md-tabs__link">
      Credits
    </a>
  </li>

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Hybrid + Identity Cyber Range" class="md-nav__button md-logo" aria-label="Hybrid + Identity Cyber Range" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Hybrid + Identity Cyber Range
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/iknowjason/PurpleCloud" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    iknowjason/PurpleCloud
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../overview/" class="md-nav__link">
        Overview
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../install/" class="md-nav__link">
        Installation
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" checked>
      
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4">
          Tool Usage
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Tool Usage" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Tool Usage
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../aad/" class="md-nav__link">
        Azure AD lab
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ad/" class="md-nav__link">
        Active Directory, Velociraptor, SIEM
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../sentinel/" class="md-nav__link">
        Sentinel lab
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../storage/" class="md-nav__link">
        Storage lab
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../midentity/" class="md-nav__link">
        Managed Identity lab
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../phishing_app/" class="md-nav__link">
        Phishing App
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../adfs/" class="md-nav__link">
        ADFS lab
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          AAD Join
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        AAD Join
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    Overview
  </a>
  
    <nav class="md-nav" aria-label="Overview">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#minimum-parameters-required" class="md-nav__link">
    Minimum Parameters Required
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#important-note" class="md-nav__link">
    Important Note
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#usage-examples" class="md-nav__link">
    Usage Examples
  </a>
  
    <nav class="md-nav" aria-label="Usage Examples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example-1-basic-azure-ad-join-lab" class="md-nav__link">
    Example 1:  Basic Azure AD Join lab
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-2-azure-ad-join-lab-with-30-users-and-3-vms" class="md-nav__link">
    Example 2:  Azure AD Join lab with 30 users and 3 VMs
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-3-azure-ad-join-lab-with-a-user-assigned-identity" class="md-nav__link">
    Example 3:  Azure AD Join lab with a User Assigned Identity
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#details" class="md-nav__link">
    Details
  </a>
  
    <nav class="md-nav" aria-label="Details">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#rdp-access-cheat-sheet-for-vm-remote-access" class="md-nav__link">
    RDP Access &amp; Cheat Sheet for VM Remote Access
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#advanced-command-line" class="md-nav__link">
    Advanced Command Line
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#terraform-outputs" class="md-nav__link">
    Terraform Outputs
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#demo" class="md-nav__link">
    Demo
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../cost/" class="md-nav__link">
        Cost
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../references/" class="md-nav__link">
        References
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../future/" class="md-nav__link">
        Roadmap Ideas
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../credits/" class="md-nav__link">
        Credits
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    Overview
  </a>
  
    <nav class="md-nav" aria-label="Overview">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#minimum-parameters-required" class="md-nav__link">
    Minimum Parameters Required
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#important-note" class="md-nav__link">
    Important Note
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#usage-examples" class="md-nav__link">
    Usage Examples
  </a>
  
    <nav class="md-nav" aria-label="Usage Examples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example-1-basic-azure-ad-join-lab" class="md-nav__link">
    Example 1:  Basic Azure AD Join lab
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-2-azure-ad-join-lab-with-30-users-and-3-vms" class="md-nav__link">
    Example 2:  Azure AD Join lab with 30 users and 3 VMs
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-3-azure-ad-join-lab-with-a-user-assigned-identity" class="md-nav__link">
    Example 3:  Azure AD Join lab with a User Assigned Identity
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#details" class="md-nav__link">
    Details
  </a>
  
    <nav class="md-nav" aria-label="Details">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#rdp-access-cheat-sheet-for-vm-remote-access" class="md-nav__link">
    RDP Access &amp; Cheat Sheet for VM Remote Access
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#advanced-command-line" class="md-nav__link">
    Advanced Command Line
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#terraform-outputs" class="md-nav__link">
    Terraform Outputs
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#demo" class="md-nav__link">
    Demo
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                

  <a href="https://github.com/iknowjason/PurpleCloud/edit/master/docs/tools/aadjoin.md" title="Edit this page" class="md-content__button md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg>
  </a>


<h1 id="azure-ad-join-lab">Azure AD Join lab</h1>
<h2 id="overview">Overview</h2>
<p>Generating an Azure AD Join lab with aadjoin.py.  This generator can be used to create a lab with Windows 10 Pro systems that automatically join to Azure Active Directory as managed devices showing in Azure AD.  This can be used for security research into specific certificates for managed device registration and SSO tokens (PRT) that are used.  Or general use cases such as exploring InTune and VDI deployments.  The script allows you to pass parameters specifying how many Windows 10 systems to create.  It requires a minimum of 1 endpoint in order to run.  It also creates Azure AD users that can be used to login to the VM. Ten (10) Azure AD users are randomly generated by default but you can specify more.  The role of <code>Virtual Machine Administrator Login</code> and <code>Virtual Machine User Login</code> is attached to all users.  This is the classic use case and benefit of Windows 10/11 managed devices, using hybrid Identity and a single set of credentials in Azure AD to log into the VM.  A System Assigned identity is automatically attached to all VMs, but you can also specify a User Assigned Identity with a specific role that you desire. </p>
<h3 id="minimum-parameters-required">Minimum Parameters Required</h3>
<p>You must pass two parameters to run the script.  The domain or UPN suffix and the number of VMs to build.</p>
<pre><code>--upn &lt;upn_suffix_domain&gt; 
</code></pre>
<pre><code>--endpoints &lt;vm_count&gt; 
</code></pre>
<h3 id="important-note">Important Note</h3>
<p>This generator lives in the <code>generators/aadjoin</code> directory.  Navigate into this directory first.</p>
<pre><code>cd generators/aadjoin
</code></pre>
<h2 id="usage-examples">Usage Examples</h2>
<h3 id="example-1-basic-azure-ad-join-lab">Example 1:  Basic Azure AD Join lab</h3>
<pre><code>python3 aadjoin.py --upn rtcfingroup.com --endpoints 1
</code></pre>
<p><strong>Description:</strong>
This will generate a single Windows 10 system that is joined to the Azure Active Directory domain based on the tenant authenticated with the Service Principal.  Ten (10) Azure AD users will be created in the Azure AD tenant specified by the UPN (<code>--upn</code>).  In this example the users will be created with <code>rtcfingroup.com</code> as their UPN suffix.  The following resources will be created, including terraform files and user output files. The default roles will be assigned to all Azure AD Users:  Virtual Machine Administrator Login, Virtual Machine User Login.  These can be customized in the <code>roles.tf</code> output file or in the python script.</p>
<ul>
<li>
<p><strong>main_aadjoin.tf:</strong> Terraform file with resource group and location.</p>
</li>
<li>
<p><strong>network_aadjoin.tf:</strong> Terraform file with VNet and subnets.</p>
</li>
<li>
<p><strong>nsg_aadjoin.tf:</strong> Terraform file with Network Security Groups.</p>
</li>
<li>
<p><strong>providers.tf:</strong> Terraform file containing terraform providers.</p>
</li>
<li>
<p><strong>sysmon.tf:</strong> Terraform file containing sysmon configuration.</p>
</li>
<li>
<p><strong>win10-1.tf:</strong> Terraform file with Windows 10 Pro configuration.</p>
</li>
<li>
<p><strong>users.tf:</strong> Terraform file that will build the Azure AD users.</p>
</li>
<li>
<p><strong>roles.tf:</strong> Terraform file that will assign the role to all Azure AD users.</p>
</li>
<li>
<p><strong>azure_users.csv:</strong> A csv including the Azure AD user's full name, username, and email address.</p>
</li>
<li>
<p><strong>azure_usernames.txt:</strong>  A file including just the usernames.</p>
</li>
<li>
<p><strong>azure_emails.txt:</strong> A file including just the email addresses.</p>
</li>
</ul>
<h3 id="example-2-azure-ad-join-lab-with-30-users-and-3-vms">Example 2:  Azure AD Join lab with 30 users and 3 VMs</h3>
<pre><code>python3 aadjoin.py --upn rtcfingroup.com --endpoints 3 --count 30 
</code></pre>
<p><strong>Description:</strong> 
Same as above, except generate 30 users in Azure AD and create three (3) Windows 10 Virtual Machines that will perform an Azure AD Join.  Running terraform apply will generate a random password shared by all users.  The password applied to all users will be displayed at the end of <code>terraform apply</code>.  To display the passwor again, run <code>terraform output</code>.  </p>
<h3 id="example-3-azure-ad-join-lab-with-a-user-assigned-identity">Example 3:  Azure AD Join lab with a User Assigned Identity</h3>
<pre><code>python3 aadjoin.py --upn rtcfingroup.com --endpoints 3 --count 30 --user_identity reader
</code></pre>
<p><strong>Description:</strong>
Same as above, except add a User Assigned Identity on all VMs with a role of <code>Reader</code> on the subscription.  Possible values for the role are reader, contributor, and owner. </p>
<h2 id="details">Details</h2>
<h3 id="rdp-access-cheat-sheet-for-vm-remote-access">RDP Access &amp; Cheat Sheet for VM Remote Access</h3>
<p>All of the VMs can be accessed over RDP.  The Azure NSGs should already be white listed to only allow a connection from your IP address.  You can run  <code>terraform apply</code> to update this.  Here is a sample output on the RDP Cheat Sheet that gives you the exact commands from a standard Ubuntu Linux to RDP to each VM with the Azure AD credentials:</p>
<pre><code>RDP Cheatsheet for Azure AD Login
---------------------------------

xfreerdp --no-nla -u &quot;AzureAD\chasemiller@rtcfingroup.com&quot; -p &quot;cosmic-stingray-96W-r&quot; --ignore-certificate 20.124.129.181
xfreerdp --no-nla -u &quot;AzureAD\arielparsons@rtcfingroup.com&quot; -p &quot;cosmic-stingray-96W-r&quot; --ignore-certificate 20.124.129.181
xfreerdp --no-nla -u &quot;AzureAD\michaelbarnett@rtcfingroup.com&quot; -p &quot;cosmic-stingray-96W-r&quot; --ignore-certificate 20.124.129.181
xfreerdp --no-nla -u &quot;AzureAD\brandongonzalez@rtcfingroup.com&quot; -p &quot;cosmic-stingray-96W-r&quot; --ignore-certificate 20.124.129.181
xfreerdp --no-nla -u &quot;AzureAD\jessicafields@rtcfingroup.com&quot; -p &quot;cosmic-stingray-96W-r&quot; --ignore-certificate 20.124.129.181
xfreerdp --no-nla -u &quot;AzureAD\brittanyriddle@rtcfingroup.com&quot; -p &quot;cosmic-stingray-96W-r&quot; --ignore-certificate 20.124.129.181
xfreerdp --no-nla -u &quot;AzureAD\rebeccaperry@rtcfingroup.com&quot; -p &quot;cosmic-stingray-96W-r&quot; --ignore-certificate 20.124.129.181
xfreerdp --no-nla -u &quot;AzureAD\josephedwards@rtcfingroup.com&quot; -p &quot;cosmic-stingray-96W-r&quot; --ignore-certificate 20.124.129.181
xfreerdp --no-nla -u &quot;AzureAD\christopherandersen@rtcfingroup.com&quot; -p &quot;cosmic-stingray-96W-r&quot; --ignore-certificate 20.124.129.181
xfreerdp --no-nla -u &quot;AzureAD\kevinmiller@rtcfingroup.com&quot; -p &quot;cosmic-stingray-96W-r&quot; --ignore-certificate 20.124.129.181
</code></pre>
<h3 id="advanced-command-line">Advanced Command Line</h3>
<p><code>--count &lt;num_of_aad_users&gt;</code>: The number of Azure AD users to automatically build (Default: 10)</p>
<p><code>--upn</code>: The upn suffix or domain name used to create Azure AD users (Default: Disabled)</p>
<p><code>--endpoints &lt;num_of_endpoints&gt;</code>: Number of Windows 10 Professional systems to build (Default: 0)</p>
<p><code>--resource_group &lt;rg_name&gt;</code>: Name of the Azure resource group to automatically create  (Default:  PurpleCloud)</p>
<p><code>--location &lt;location&gt;</code>: The Azure location to use (Default:  eastus)</p>
<p><code>--admin &lt;admin_username&gt;</code>: The Local Administrator account (Default:  RTCAdmin)</p>
<p><code>--password &lt;password&gt;</code>: The local Administrator password and default AD user password (Default:  auto generate a strong password)</p>
<p><code>--user_identity</code>: The User Assigned Identity to assign to each VM.  The scope will be on the subscription.  Possible values are reader, contributor, owner (Default:  false)</p>
<p><strong>Other Details:</strong></p>
<ul>
<li>
<p><strong>ranges.log:</strong>  The ranges.log file writes out important information as the range is built, such as VM details.  You can use it to track things.</p>
</li>
<li>
<p><strong>Logging Passwords:</strong> By default, all passwords are randomly generated.  So if you are not aware of this, it might be easy to lose track of a password.  For this reason we have added a logging feature that captures all passwords created.  The <code>ad.py</code> script will automatically log all output to a logfile called <code>ranges.log</code>.  This is for the specific purpose of being able to track the ranges created and the passwords that are auto-generated for AD users and local Administrator accounts. You can also type <code>terraform output</code> as a secondary way to get the password and details for each virtual machine.</p>
</li>
<li>
<p><strong>Azure Network Security Groups:</strong>  By default, a terraform data http resource will auto-detect your public IP address using a request to http://ifconfig.me.  Your public IP address will be used to white list the Azure NSG source prefix setting.  If you change locations and your IP address changes, simply type <code>terraform apply</code> and the NSG white-listed public IP address should update through terraform.</p>
</li>
</ul>
<pre><code>locals {
  src_ip = chomp(data.http.firewall_allowed.response_body)
  #src_ip = &quot;0.0.0.0/0&quot;
}
</code></pre>
<ul>
<li><strong>Outputs:</strong> After the terraform resources are applied and build, you can type <code>terraform output</code> to get some important information such as the public IP address of VMs in addition to local Administrator credentials and Azure AD Login over RDP.</li>
</ul>
<h3 id="terraform-outputs">Terraform Outputs</h3>
<p>You can get the details of each Virtual Machine, including passwords, by typing <code>terraform output</code>.  The RDP connection cheat sheet will also show how to login to each VM using Azure AD credentials.</p>
<h2 id="demo">Demo</h2>
<p>A video demonstration of Azure AD Join lab with options and illustrations.</p>
<p><a href="https://youtu.be/glTER6jxJYU" title="Azure AD Join lab Demo"><img alt="Azure AD Join lab Demo" src="" /></a> </p>




              
            </article>
            
          </div>
        </div>
        
          <a href="#" class="md-top md-icon" data-md-component="top" hidden>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            Back to top
          </a>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href="../adfs/" class="md-footer__link md-footer__link--prev" aria-label="Previous: ADFS lab" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              ADFS lab
            </div>
          </div>
        </a>
      
      
        
        <a href="../../cost/" class="md-footer__link md-footer__link--next" aria-label="Next: Cost" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Cost
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.instant", "navigation.tracking", "navigation.sections", "navigation.expand", "navigation.indexes", "navigation.top", "navigation.tabs"], "search": "../../assets/javascripts/workers/search.ecf98df9.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.2ab50757.min.js"></script>
      
    
  </body>
</html>